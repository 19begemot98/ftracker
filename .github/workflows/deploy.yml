name: Deploy to GitHub Pages

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Build $mol app
        uses: hyoo-ru/mam_build@master2
        with:
          token: ${{ secrets.GH_PAT }}
          package: 'ftracker'
          modules: '.'
          meta: |
            my https://github.com/19begemot98/ftracker

      - name: Find and Move Build Artifacts
        run: |
          echo "üîç Searching for web.js..."
          BUILD_DIR=$(find . -name web.js | grep "/-/" | head -n 1 | xargs dirname)
          if [ -z "$BUILD_DIR" ]; then
            echo "‚ùå Error: Build failed! web.js not found."
            find . -maxdepth 4 -not -path '*/.*' # –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            exit 1
          fi
          echo "‚úÖ Found build artifacts in: $BUILD_DIR"
          echo "üöö Moving files to ftracker/ root..."
          cp -r $BUILD_DIR/* ftracker/
      - name: Create .nojekyll
        run: touch ftracker/.nojekyll
      - name: Deploy to GitHub Pages
        if: github.ref == 'refs/heads/main'
        uses: alex-page/blazing-fast-gh-pages-deploy@v1.1.0
        with:
          repo-token: ${{ secrets.GH_PAT }}
          site-directory: 'ftracker'
